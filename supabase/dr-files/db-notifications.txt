-- Create a table for User Notifications
create table notifications (
  id bigint generated by default as identity primary key,
  user_id uuid references auth.users not null,
  message text not null,
  mode text not null,
  completed boolean default false,
  object_type text,
  object_id text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

alter table notifications enable row level security;


create policy "Users can insert their own notifications."
  ON public.notifications
  FOR INSERT 
  TO authenticated 
  WITH CHECK (true);

CREATE POLICY "Users can view their own notifications."
ON public.notifications
FOR SELECT 
TO authenticated 
WITH (true);


CREATE POLICY "Users can view their own notifications."
ON public.notifications
FOR SELECT 
TO authenticated 
using ( auth.uid() = user_id );

create policy "Users can update own notifications."
  on notifications for update
  TO authenticated 
  using ( auth.uid() = user_id );


-- add tables to the publication
alter publication supabase_realtime add table public.notifications;